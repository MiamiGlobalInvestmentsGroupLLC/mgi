import { NextRequest } from 'next/server'; import { prisma } from '@/lib/prisma'; import { stripHtml } from '@/lib/text'; export const runtime='nodejs'; export async function POST(req:NextRequest){ const cid=req.cookies.get('companyId')?.value; if(!cid) return new Response(JSON.stringify({error:'NO_AUTH'}),{status:401}); const { url } = await req.json(); if(!url) return new Response(JSON.stringify({error:'NO_URL'}),{status:400}); const res = await fetch(url, { headers:{ 'User-Agent':'Mozilla/5.0 (MGI-Bot/1.0)'} }); if(!res.ok) return new Response(JSON.stringify({error:'FETCH_FAIL'}),{status:400}); const html = await res.text(); const text = stripHtml(html).slice(0, 20000); await prisma.document.create({data:{companyId:cid, source:'url', title:url, url, text}}); return new Response(JSON.stringify({ok:true})); }